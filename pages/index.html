<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f172a">
    <meta name="application-name" content="Osoul Pro">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Osoul Pro">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>أصول برو | Osoul Pro</title>
    <link id="appFavicon" rel="icon" type="image/png" href="../assets/icons/Osoul Pro Dark Mode.png">
    <link id="appFaviconShortcut" rel="shortcut icon" type="image/png" href="../assets/icons/Osoul Pro Dark Mode.png">
    <link rel="icon" type="image/png" sizes="192x192" href="../assets/icons/pwa/icon-192.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../assets/icons/pwa/icon-180.png">
    <link rel="manifest" href="../manifest.json">


    <script>
        (function () {
            const LS_KEY_THEME = 'smcw_theme_preference';
            const root = document.documentElement;
            const savedTheme = localStorage.getItem(LS_KEY_THEME) || 'dark';
            root.setAttribute('data-theme', savedTheme);
            if (savedTheme === 'light') {
                root.classList.remove('dark');
            } else {
                root.classList.add('dark');
            }

            const iconHref = savedTheme === 'light'
                ? '../assets/icons/Osoul Pro Light Mode.png'
                : '../assets/icons/Osoul Pro Dark Mode.png';
            const faviconEl = document.getElementById('appFavicon');
            const faviconShortcutEl = document.getElementById('appFaviconShortcut');
            if (faviconEl) faviconEl.href = iconHref;
            if (faviconShortcutEl) faviconShortcutEl.href = iconHref;

            document.addEventListener('DOMContentLoaded', function () {
                const logos = document.querySelectorAll('.theme-aware-logo');
                logos.forEach(function (logoEl) {
                    logoEl.setAttribute('src', iconHref);
                });
            });
        })();
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="../assets/css/styles.css">
<!-- Tailwind and Flowbite -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.css" rel="stylesheet" />
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        // ═══════════════════════════════════════════════════════════
                        // Tailwind CSS Standard Colors - Flowbite Compatible
                        // All colors use official Tailwind palette
                        // ═══════════════════════════════════════════════════════════

                        // Primary - Tailwind Blue (blue-*)
                        primary: {
                            "50": "#eff6ff", "100": "#dbeafe", "200": "#bfdbfe", "300": "#93c5fd",
                            "400": "#60a5fa", "500": "#3b82f6", "600": "#2563eb", "700": "#1d4ed8",
                            "800": "#1e40af", "900": "#1e3a8a", "950": "#172554"
                        },
                        // Success - Tailwind Emerald (emerald-*)
                        success: {
                            "50": "#ecfdf5", "100": "#d1fae5", "200": "#a7f3d0", "300": "#6ee7b7",
                            "400": "#34d399", "500": "#10b981", "600": "#059669", "700": "#047857",
                            "800": "#065f46", "900": "#064e3b", "950": "#022c22"
                        },
                        // Danger - Tailwind Rose (rose-*)
                        danger: {
                            "50": "#fff1f2", "100": "#ffe4e6", "200": "#fecdd3", "300": "#fda4af",
                            "400": "#fb7185", "500": "#f43f5e", "600": "#e11d48", "700": "#be123c",
                            "800": "#9f1239", "900": "#881337", "950": "#4c0519"
                        },
                        // Warning - Tailwind Amber (amber-*)
                        warning: {
                            "50": "#fffbeb", "100": "#fef3c7", "200": "#fde68a", "300": "#fcd34d",
                            "400": "#fbbf24", "500": "#f59e0b", "600": "#d97706", "700": "#b45309",
                            "800": "#92400e", "900": "#78350f", "950": "#451a03"
                        },
                        // Info - Tailwind Sky (sky-*)
                        info: {
                            "50": "#f0f9ff", "100": "#e0f2fe", "200": "#bae6fd", "300": "#7dd3fc",
                            "400": "#38bdf8", "500": "#0ea5e9", "600": "#0284c7", "700": "#0369a1",
                            "800": "#075985", "900": "#0c4a6e", "950": "#082f49"
                        }
                    }
                }
            }
        }
    </script>
</head>

<body>

    <header class="app-header">
        <div class="candles-layer" aria-hidden="true"></div>
        <div class="header-inner">
            <div class="header-center">
                <h1 class="site-title">
                    <div class="logo-wrapper">
                        <img class="header-logo-svg theme-aware-logo" src="../assets/icons/Osoul Pro Dark Mode.png"
                            alt="Osoul Pro Logo" loading="eager" decoding="async">
                    </div>
                    <div class="title-wrapper">
                        <span class="title-text">Osoul Pro | أصول برو</span>
                        <div class="site-subtitle">نظام إدارة محفظة العملات الرقمية الإحترافي</div>
                    </div>
                </h1>
            </div>
        </div>
    </header>

    <!-- Action Bar -->


    <!-- Dropdown Backdrop -->
    <div class="dropdown-backdrop" id="dropdownBackdrop"></div>

    <div class="crypto-ticker-wrap">
        <div class="ticker-scroll" id="cryptoTicker">

            <div class="ticker-skeleton">
                <div class="skeleton-icon"></div>
                <div class="skeleton-text" style="width: 40px;"></div>
                <div class="skeleton-text" style="width: 60px;"></div>
            </div>
            <div class="ticker-skeleton">
                <div class="skeleton-icon"></div>
                <div class="skeleton-text" style="width: 40px;"></div>
                <div class="skeleton-text" style="width: 60px;"></div>
            </div>
            <div class="ticker-skeleton">
                <div class="skeleton-icon"></div>
                <div class="skeleton-text" style="width: 40px;"></div>
                <div class="skeleton-text" style="width: 60px;"></div>
            </div>
            <div class="ticker-skeleton">
                <div class="skeleton-icon"></div>
                <div class="skeleton-text" style="width: 40px;"></div>
                <div class="skeleton-text" style="width: 60px;"></div>
            </div>
            <div class="ticker-skeleton">
                <div class="skeleton-icon"></div>
                <div class="skeleton-text" style="width: 40px;"></div>
                <div class="skeleton-text" style="width: 60px;"></div>
            </div>
            <div class="ticker-skeleton">
                <div class="skeleton-icon"></div>
                <div class="skeleton-text" style="width: 40px;"></div>
                <div class="skeleton-text" style="width: 60px;"></div>
            </div>
            <div class="ticker-skeleton">
                <div class="skeleton-icon"></div>
                <div class="skeleton-text" style="width: 40px;"></div>
                <div class="skeleton-text" style="width: 60px;"></div>
            </div>
            <div class="ticker-skeleton">
                <div class="skeleton-icon"></div>
                <div class="skeleton-text" style="width: 40px;"></div>
                <div class="skeleton-text" style="width: 60px;"></div>
            </div>
            <div class="ticker-skeleton">
                <div class="skeleton-icon"></div>
                <div class="skeleton-text" style="width: 40px;"></div>
                <div class="skeleton-text" style="width: 60px;"></div>
            </div>
            <div class="ticker-skeleton">
                <div class="skeleton-icon"></div>
                <div class="skeleton-text" style="width: 40px;"></div>
                <div class="skeleton-text" style="width: 60px;"></div>
            </div>
            <div class="ticker-skeleton">
                <div class="skeleton-icon"></div>
                <div class="skeleton-text" style="width: 40px;"></div>
                <div class="skeleton-text" style="width: 60px;"></div>
            </div>
            <div class="ticker-skeleton">
                <div class="skeleton-icon"></div>
                <div class="skeleton-text" style="width: 40px;"></div>
                <div class="skeleton-text" style="width: 60px;"></div>
            </div>
        </div>
    </div>



    <div id="confirm-modal">
        <div class="confirm-dialog">
            <div class="confirm-header">
                <i class="fas fa-exclamation-triangle confirm-icon"></i>
                <div class="confirm-title">تأكيد العملية</div>
            </div>
            <div class="confirm-message" id="confirm-message"></div>
            <div class="confirm-buttons flex gap-3 justify-end mt-6">
                <button id="confirm-no"
                    class="px-5 py-2.5 text-sm font-medium text-slate-700 bg-slate-100 hover:bg-slate-200 rounded-xl dark:bg-slate-800 dark:text-slate-300 dark:hover:bg-slate-700 transition-colors">إلغاء</button>
                <button id="confirm-yes"
                    class="px-5 py-2.5 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-xl shadow-lg shadow-blue-500/30 transition-all">تأكيد</button>
            </div>
        </div>
    </div>



    <div id="datetimeModal" tabindex="-1" aria-hidden="true"
        class="fixed inset-0 z-[120] hidden items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm transition-all duration-300">
        <div
            class="relative w-full max-w-sm bg-white rounded-2xl shadow-2xl dark:bg-slate-900 border border-slate-100 dark:border-slate-800 transition-all transform scale-95 opacity-0 modal-content-anim overflow-hidden">
            <!-- Modal header -->
            <div class="flex items-center justify-between p-5 border-b rounded-t dark:border-slate-800">
                <h3 class="text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2">
                    <i class="far fa-calendar-alt text-blue-600"></i> تحديد التاريخ
                </h3>
                <button type="button"
                    class="text-slate-400 bg-transparent hover:bg-slate-100 hover:text-slate-900 rounded-xl text-sm w-9 h-9 inline-flex justify-center items-center dark:hover:bg-slate-800 dark:hover:text-white transition-all"
                    onclick="closeDateTimeModal()">
                    <svg class="w-3.5 h-3.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                        viewBox="0 0 14 14">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                    </svg>
                    <span class="sr-only">إغلاق</span>
                </button>
            </div>
            <!-- Modal body -->
            <div class="p-6 space-y-6">
                <!-- Quick Time Buttons -->
                <div class="flex flex-wrap gap-2">
                    <button onclick="setQuickTime('now')"
                        class="flex-1 py-2 px-3 text-xs font-bold text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-xl dark:bg-blue-900/20 dark:text-blue-400 dark:hover:bg-blue-900/40 transition-all border border-blue-100 dark:border-blue-800/50">
                        <i class="fas fa-clock ml-1"></i> الآن
                    </button>
                    <button onclick="setQuickTime('today')"
                        class="flex-1 py-2 px-3 text-xs font-bold text-emerald-600 bg-emerald-50 hover:bg-emerald-100 rounded-xl dark:bg-emerald-900/20 dark:text-emerald-400 dark:hover:bg-emerald-900/40 transition-all border border-emerald-100 dark:border-emerald-800/50">
                        <i class="fas fa-calendar-day ml-1"></i> اليوم
                    </button>
                    <button onclick="setQuickTime('yesterday')"
                        class="flex-1 py-2 px-3 text-xs font-bold text-indigo-600 bg-indigo-50 hover:bg-indigo-100 rounded-xl dark:bg-indigo-900/20 dark:text-indigo-400 dark:hover:bg-indigo-900/40 transition-all border border-indigo-100 dark:border-indigo-800/50">
                        <i class="fas fa-calendar-minus ml-1"></i> الأمس
                    </button>
                </div>

                <!-- Date Picker Area -->
                <div
                    class="bg-slate-50 dark:bg-slate-800/50 p-4 rounded-2xl border border-slate-100 dark:border-slate-800 shadow-inner">
                    <div class="flex items-center justify-between mb-4">
                        <button id="prevMonth" onclick="changeMonth(-1)"
                            class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-400 transition-all">‹</button>
                        <span id="currentMonthYear" class="text-sm font-bold text-slate-700 dark:text-slate-300"></span>
                        <button id="nextMonth" onclick="changeMonth(1)"
                            class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-400 transition-all">›</button>
                    </div>
                    <div class="grid grid-cols-7 gap-1 text-center mb-2">
                        <div class="text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase">ح</div>
                        <div class="text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase">ن</div>
                        <div class="text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase">ث</div>
                        <div class="text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase">ر</div>
                        <div class="text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase">خ</div>
                        <div class="text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase">ج</div>
                        <div class="text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase">س</div>
                    </div>
                    <div class="grid grid-cols-7 gap-1" id="datePickerDays"></div>
                </div>

            </div>
            <!-- Modal footer -->
            <div
                class="flex items-center justify-end p-6 space-x-3 gap-3 border-t border-slate-100 dark:border-slate-800 rounded-b bg-slate-50/50 dark:bg-slate-900/50">
                <button type="button"
                    class="px-6 py-2.5 text-sm font-medium text-slate-700 bg-white border border-slate-200 hover:bg-slate-50 rounded-xl dark:bg-slate-800 dark:text-slate-300 dark:border-slate-700 dark:hover:bg-slate-700 transition-all shadow-sm"
                    onclick="closeDateTimeModal()">إلغاء</button>
                <button type="button"
                    class="px-8 py-2.5 text-sm font-bold text-white bg-blue-600 hover:bg-blue-700 rounded-xl shadow-lg shadow-blue-500/30 transition-all"
                    onclick="saveDateTimeSelection()">حفظ التعديلات</button>
            </div>
        </div>
    </div>

    <div class="container">

        <!-- Financial Overview Dashboard Cards -->
        <section class="section section-financial-overview">
            <div class="financial-cards-grid">
                <!-- Principal Cash Card -->
                <div class="financial-card principal-card" onclick="openPrincipalModal()">
                    <div class="card-content-left">
                        <div class="card-label">(Principal) رأس المال الأساسي</div>
                        <div class="card-value" id="principalCashDisplay">0.00 $</div>
                        <button onclick="event.stopPropagation(); openPrincipalModal()"
                            class="mt-4 w-full text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-xl text-sm px-5 py-2.5 text-center inline-flex items-center justify-center dark:bg-blue-500 dark:hover:bg-blue-600 dark:focus:ring-blue-800 transition-all"
                            id="managePrincipalBtn" type="button">
                            <i class="fas fa-university ml-2"></i> إدارة رأس المال
                        </button>
                    </div>
                </div>

                <!-- Profit Wallet Card -->
                <div class="financial-card profit-card">
                    <div class="card-content-left">
                        <div class="card-label">(Profit) الأرباح المحققة</div>
                        <div class="card-value profit-value" id="profitWalletDisplay">0.00 $</div>
                        <button onclick="event.stopPropagation(); transferProfitsToCash()"
                            class="mt-4 w-full text-white bg-emerald-600 hover:bg-emerald-700 focus:ring-4 focus:outline-none focus:ring-emerald-300 font-medium rounded-xl text-sm px-5 py-2.5 text-center inline-flex items-center justify-center dark:bg-emerald-500 dark:hover:bg-emerald-600 dark:focus:ring-emerald-800 transition-all"
                            id="transferProfitsBtn">
                            <i class="fas fa-exchange-alt ml-2"></i> نقل الأرباح إلى رأس المال
                        </button>
                    </div>
                </div>

                <!-- Realized Loss Card -->
                <div class="financial-card loss-card">
                    <div class="card-content-left">
                        <div class="card-label">(Loss) الخسائر المحققة</div>
                        <div class="card-value loss-value" id="realizedLossDisplay">0.00 $</div>
                        <button onclick="event.stopPropagation(); resetRealizedLoss()"
                            class="mt-4 w-full text-white bg-rose-600 hover:bg-rose-700 focus:ring-4 focus:outline-none focus:ring-rose-300 font-medium rounded-xl text-sm px-5 py-2.5 text-center inline-flex items-center justify-center dark:bg-rose-500 dark:hover:bg-rose-600 dark:focus:ring-rose-800 transition-all"
                            id="resetLossBtn">
                            <i class="fas fa-undo ml-2"></i> إعادة تعيين الخسائر
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <section class="overall-summary-section">

            <div class="professional-toolbar">
                <div class="toolbar-controls">
                    <div class="relative w-full max-w-sm toolbar-search">
                        <div
                            class="absolute inset-y-0 start-0 flex items-center ps-3.5 pointer-events-none toolbar-search-icon">
                            <svg class="w-4 h-4 text-slate-500 dark:text-slate-400" aria-hidden="true"
                                xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <path stroke="currentColor" stroke-linecap="round" stroke-width="2"
                                    d="m21 21-3.5-3.5M17 10a7 7 0 1 1-14 0 7 7 0 0 1 14 0Z" />
                            </svg>
                        </div>
                        <input type="text" id="tableSearchInput" oninput="filterTableCoins()"
                            class="block w-full p-2.5 ps-11 bg-white border border-slate-200 text-slate-900 text-sm rounded-xl focus:ring-blue-500 focus:border-blue-500 dark:bg-slate-800 dark:border-slate-700 dark:placeholder-slate-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 shadow-sm transition-all text-right"
                            placeholder="بحث عن عملة..." required />
                    </div>
                    <div id="networkStatusBadge" class="network-status-badge is-checking" role="status" aria-live="polite"
                        aria-label="جاري فحص الاتصال" title="جاري فحص الاتصال">
                        <i id="networkStatusBadgeIcon" class="fas fa-spinner fa-spin" aria-hidden="true"></i>
                    </div>
                    <button id="exchangeSettingsBtn" type="button"
                        class="exchange-settings-btn text-gray-900 bg-white border border-gray-200 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 font-medium rounded-xl text-sm px-5 py-2.5 dark:bg-slate-800 dark:text-white dark:border-slate-600 dark:hover:bg-slate-700 dark:focus:ring-slate-700 transition-all"
                        title="تغيير البلد/المنصة (Spot Fees)">
                        <span id="exchangeSettingsCountryFlag" class="exchange-settings-flag" aria-hidden="true"><span class="spot-flag-media is-fallback">--</span></span>
                        <span id="exchangeSettingsLabel" class="exchange-settings-label">تغيير البلد/المنصة</span>
                    </button>
                    <button id="financialPrivacyToggle" type="button" onclick="toggleFinancialPrivacyMode()"
                        class="financial-privacy-toggle text-gray-900 bg-white border border-gray-200 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 font-medium rounded-xl text-sm px-5 py-2.5 dark:bg-slate-800 dark:text-white dark:border-slate-600 dark:hover:bg-slate-700 dark:focus:ring-slate-700 transition-all"
                        title="Financial Privacy Mode" aria-pressed="false">
                        <span id="financialPrivacyToggleIcon" class="privacy-icon" aria-hidden="true"><i class="fas fa-eye"></i></span>
                        <span id="financialPrivacyToggleLabel" class="privacy-label">إظهار الأموال</span>
                    </button>
                    <div class="toolbar-status">
                        <div id="apiStatus"><i class="fas fa-info-circle"></i>اختر عملة</div>
                    </div>
                    <button id="chartBtn" onclick="openTradingViewChart()" disabled
                        class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-xl text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
                        <i class="fas fa-chart-line ml-2"></i>
                        <span>شارت</span>
                        <span id="chartCoinName" class="mr-2 opacity-80 text-xs"></span>
                    </button>
                </div>
                <div id="exchangeFeeWarning" class="exchange-fee-warning" hidden>
                    <span id="exchangeFeeWarningText">قد تكون الرسوم تغيّرت - تحقق من المصدر</span>
                    <button id="exchangeFeeWarningAction" type="button">
                        <i class="fas fa-up-right-from-square" aria-hidden="true"></i>
                        <span>فتح مصدر الرسوم</span>
                    </button>
                </div>
            </div>
            <div class="summary-table-container">
                <table class="summary-table">
                    <thead>
                        <tr>
                            <th>
                                <div class="header-item"><i class="fab fa-bitcoin"></i> العملة</div>
                            </th>
                            <th>
                                <div class="header-item"><i class="fas fa-coins"></i>الكمية</div>
                            </th>
                            <th>
                                <div class="header-item"><i class="fas fa-dollar-sign"></i>المستثمر</div>
                            </th>
                            <th>
                                <div class="header-item"><i class="fas fa-balance-scale"></i>متوسط الدخول</div>
                            </th>
                            <th>
                                <div class="header-item"><i class="fas fa-chart-area"></i>السعر الحالي</div>
                            </th>
                            <th>
                                <div class="header-item"><i class="fas fa-dollar-sign"></i>القيمة الحالية</div>
                            </th>
                            <th>
                                <div class="header-item"><i class="fas fa-dollar-sign"></i>الربح / الخسارة</div>
                            </th>
                            <th>
                                <div class="header-item"><i class="fas fa-percentage"></i>الربح / الخسارة</div>
                            </th>
                            <th>
                                <div class="header-item"><i class="fas fa-receipt"></i>إجمالي الرسوم</div>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="summaryTableBody">
                        <tr>
                            <td colspan="9"
                                style="text-align:center; padding: 30px; font-weight: normal; color: var(--text-muted);">
                                <i class="fas fa-info-circle"></i>أضف عملة أو قم بتحديث الأسعار لعرض الملخص...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="summary-totals">
                <div> <label><i class="fas fa-dollar-sign"></i>إجمالي المبلغ المستثمر</label> <span
                        id="totalInvestedSummary" class="ltr-text">0.00</span> </div>
                <div> <label><i class="fas fa-dollar-sign"></i>إجمالي الربح / الخسارة</label> <span
                        id="totalPnlAmountSummary" class="ltr-text">0.00</span> </div>
                <div> <label><i class="fas fa-dollar-sign"></i>إجمالي القيمة الحالية</label> <span
                        id="totalCurrentValueSummary" class="ltr-text">0.00</span> </div>
                <div> <label><i class="fas fa-percentage"></i>إجمالي الربح / الخسارة</label> <span
                        id="totalPnlPercentSummary" class="ltr-text">0.00</span> </div>
            </div>
        </section>

        <div class="controls-bar controls-main">

            <div class="controls-left flex flex-col sm:flex-row gap-4 mb-6">
                <div class="w-full">
                    <label for="coinSelector"
                        class="block mb-2 text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-tighter">
                        <i class="fab fa-bitcoin ml-1.5 text-orange-400"></i>العملة المختارة
                    </label>
                    <select id="coinSelector" onchange="handleCoinSelectionChange()"
                        class="block w-full px-4 py-3 bg-white border border-slate-200 text-slate-900 text-sm rounded-xl focus:ring-blue-500 focus:border-blue-500 dark:bg-slate-800 dark:border-slate-700 dark:text-white transition-all shadow-sm cursor-pointer">
                    </select>
                </div>

                <div class="w-full">
                    <label for="newCoinName"
                        class="block mb-2 text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-tighter">
                        <i class="fas fa-search ml-1.5 text-blue-500"></i>إضافة عملة جديدة
                    </label>
                    <input type="text" id="newCoinName" placeholder="BTCUSDT"
                        class="block w-full px-4 py-3 bg-white border border-slate-200 text-slate-900 text-sm rounded-xl focus:ring-blue-500 focus:border-blue-500 dark:bg-slate-800 dark:border-slate-700 dark:placeholder-slate-500 dark:text-white transition-all shadow-sm">
                </div>
            </div>





            <div class="controls-right">
                <input type="file" id="importTxtFile" accept=".txt, .json" style="display:none"
                    onchange="handleImportTxtFile(event)">

                <div class="controls-actions">
                    <button id="addCoinBtn" onclick="addOrSwitchCoin()"
                        class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-xl text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800 transition-all">
                        <i class="fas fa-plus ml-2"></i> إضافة
                    </button>
                    <button id="refreshPriceBtn" onclick="fetchAllPrices()"
                        class="text-white bg-emerald-600 hover:bg-emerald-700 focus:ring-4 focus:outline-none focus:ring-emerald-300 font-medium rounded-xl text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-emerald-500 dark:hover:bg-emerald-600 dark:focus:ring-emerald-800 transition-all">
                        <i class="fas fa-sync-alt ml-2"></i> تحديث
                    </button>

                    <button id="saveDataBtn" onclick="downloadAllDataAsTxt()"
                        class="text-gray-900 bg-white border border-gray-200 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 font-medium rounded-xl text-sm px-5 py-2.5 dark:bg-slate-800 dark:text-white dark:border-slate-600 dark:hover:bg-slate-700 dark:focus:ring-slate-700 transition-all">
                        <i class="fas fa-save ml-2"></i> حفظ
                    </button>
                    <button id="importDataBtn" onclick="document.getElementById('importTxtFile').click()"
                        class="text-gray-900 bg-white border border-gray-200 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 font-medium rounded-xl text-sm px-5 py-2.5 dark:bg-slate-800 dark:text-white dark:border-slate-600 dark:hover:bg-slate-700 dark:focus:ring-slate-700 transition-all">
                        <i class="fas fa-file-import ml-2"></i> استيراد
                    </button>

                    <button id="selectCoinsBtn" onclick="toggleSelectCoinsMode()"
                        class="text-white bg-indigo-600 hover:bg-indigo-700 focus:ring-4 focus:outline-none focus:ring-indigo-300 font-medium rounded-xl text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-indigo-500 dark:hover:bg-indigo-600 dark:focus:ring-indigo-800 transition-all">
                        <i class="fas fa-check-square ml-2"></i> اختيار
                    </button>
                    <button id="deleteCoinBtn" onclick="deleteCurrentCoin()" disabled
                        class="text-white bg-rose-600 hover:bg-rose-700 focus:ring-4 focus:outline-none focus:ring-rose-300 font-medium rounded-xl text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-rose-500 dark:hover:bg-rose-600 dark:focus:ring-rose-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
                        <i class="fas fa-trash-alt ml-2"></i> حذف
                    </button>


                    <button id="deleteSelectedBtn" onclick="deleteSelectedCoins()" disabled
                        class="hidden text-white bg-rose-700 hover:bg-rose-800 focus:ring-4 focus:outline-none focus:ring-rose-300 font-medium rounded-xl text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-rose-600 dark:hover:bg-rose-700 dark:focus:ring-rose-800 transition-all">
                        <i class="fas fa-trash-alt ml-2"></i> حذف المختارة
                    </button>
                    <button id="cancelSelectBtn" onclick="cancelSelectCoinsMode()"
                        class="hidden text-white bg-amber-500 hover:bg-amber-600 focus:ring-4 focus:outline-none focus:ring-amber-300 font-medium rounded-xl text-sm px-5 py-2.5 text-center inline-flex items-center transition-all">
                        <i class="fas fa-times ml-2"></i> إلغاء
                    </button>
                    <button id="deleteAllBtn" onclick="deleteAllCoins()"
                        class="hidden text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-xl text-sm px-5 py-2.5 text-center inline-flex items-center transition-all">
                        <i class="fas fa-trash ml-2"></i> حذف الكل
                    </button>

                    <button id="themeBtn" onclick="toggleTheme()"
                        class="text-gray-900 bg-white border border-gray-200 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 font-medium rounded-xl text-sm px-5 py-2.5 dark:bg-slate-800 dark:text-white dark:border-slate-600 dark:hover:bg-slate-700 dark:focus:ring-slate-700 transition-all">
                        <i class="far fa-lightbulb ml-2"></i> المظهر
                    </button>
                    <button id="bugReportBtn" type="button" onclick="openBugReportModal()"
                        class="text-gray-900 bg-white border border-gray-200 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 font-medium rounded-xl text-sm px-5 py-2.5 dark:bg-slate-800 dark:text-white dark:border-slate-600 dark:hover:bg-slate-700 dark:focus:ring-slate-700 transition-all"
                        title="الإبلاغ عن مشكلة">
                        <i class="fas fa-bug ml-2 text-rose-500"></i> الإبلاغ
                    </button>

                    <div
                        class="flex items-center ps-4 pe-2 bg-slate-100/50 border border-slate-200 rounded-xl dark:bg-slate-800/40 dark:border-slate-700 transition-all hover:bg-slate-200/50 dark:hover:bg-slate-800/60 h-[43px] controls-toggle">
                        <input type="checkbox" id="autoRefreshCheckbox"
                            class="w-4 h-4 text-blue-600 bg-white border-slate-300 rounded focus:ring-blue-500 dark:bg-slate-700 dark:border-slate-600 cursor-pointer">
                        <label for="autoRefreshCheckbox"
                            class="flex items-center select-none ms-2 text-[11px] font-bold text-slate-600 dark:text-slate-400 cursor-pointer whitespace-nowrap"
                            title="تحديث تلقائي للأسعار">
                            <i class="fas fa-sync ml-1 text-blue-500"></i> تحديث تلقائي
                        </label>
                    </div>

                    <div
                        class="flex items-center ps-4 pe-2 bg-slate-100/50 border border-slate-200 rounded-xl dark:bg-slate-800/40 dark:border-slate-700 transition-all hover:bg-slate-200/50 dark:hover:bg-slate-800/60 h-[43px] controls-toggle">
                        <input type="checkbox" id="usdtToggleCheckbox"
                            class="w-4 h-4 text-blue-600 bg-white border-slate-300 rounded focus:ring-blue-500 dark:bg-slate-700 dark:border-slate-600 cursor-pointer">
                        <label for="usdtToggleCheckbox"
                            class="flex items-center select-none ms-2 text-[11px] font-bold text-slate-600 dark:text-slate-400 cursor-pointer whitespace-nowrap"
                            title="إخفاء زوج التسعير لكل الأزواج">
                            <i class="fas fa-eye-slash ml-1 text-rose-500"></i> إخفاء الزوج
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <div class="details-content-wrapper">
            <!-- 1. Entry Details / Current Status / Targets (MOVED TO TOP) -->
            <!-- 1. Compact Dashboard (Optimized Entry Section) -->
            <section class="section section-initial-and-targets">
                <h2><i class="fas fa-tachometer-alt"></i> لوحة التحكم <span id="currentCoinDisplay1" class="coin-badge">
                        --- </span></h2>

                <div class="dashboard-container">

                    <!-- Card 1: Entry Data -->
                    <div
                        class="dashboard-card card-entry bg-white dark:bg-slate-900 rounded-2xl p-5 border border-slate-100 dark:border-slate-800 shadow-sm transition-all hover:shadow-md">
                        <div
                            class="card-header text-sm font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2">
                            <span class="card-header-icon" aria-hidden="true"><i class="fas fa-pen-to-square"></i></span>
                            <span class="card-header-title">بيانات الدخول</span>
                        </div>
                        <div class="card-content space-y-4">
                            <div class="space-y-2">
                                <label for="initialEntryPrice"
                                    class="block text-xs font-semibold text-slate-500 dark:text-slate-400">سعر
                                    الدخول</label>
                                <input type="number" id="initialEntryPrice" placeholder="0.00"
                                    oninput="saveAndCalculate()"
                                    class="bg-slate-50 border border-slate-200 text-slate-900 text-sm rounded-xl focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-slate-800 dark:border-slate-700 dark:placeholder-slate-500 dark:text-white transition-all">
                            </div>
                            <div class="space-y-2">
                                <label for="initialAmountDollars"
                                    class="block text-xs font-semibold text-slate-500 dark:text-slate-400">المبلغ
                                    ($)</label>
                                <input type="number" id="initialAmountDollars" placeholder="0.00"
                                    oninput="saveAndCalculate()"
                                    class="bg-slate-50 border border-slate-200 text-slate-900 text-sm rounded-xl focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-slate-800 dark:border-slate-700 dark:placeholder-slate-500 dark:text-white transition-all">
                            </div>
                            <div
                                class="flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/10 rounded-xl border border-blue-100/50 dark:border-blue-800/20 mt-2">
                                <span class="text-xs font-medium text-blue-700 dark:text-blue-400">الكمية
                                    الأولية:</span>
                                <span id="initialCoinQty"
                                    class="text-sm font-bold text-blue-900 dark:text-blue-200 mono-font">0.00</span>
                            </div>
                        </div>
                    </div>

                    <!-- Card 2: Performance (Live Stats) -->
                    <div
                        class="dashboard-card card-stats bg-white dark:bg-slate-900 rounded-2xl p-5 border border-slate-100 dark:border-slate-800 shadow-sm transition-all hover:shadow-md">
                        <div
                            class="card-header text-sm font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2">
                            <span class="card-header-icon" aria-hidden="true"><i class="fas fa-chart-line"></i></span>
                            <span class="card-header-title">الأداء المباشر</span>
                        </div>
                        <div class="card-content space-y-6">
                            <!-- Hero Stats -->
                            <div
                                class="grid grid-cols-3 gap-3 p-4 bg-slate-50 dark:bg-slate-800/40 rounded-2xl border border-slate-100 dark:border-slate-800 shadow-inner">
                                <div class="text-center">
                                    <div
                                        class="text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase mb-1">
                                        السعر الحالي</div>
                                    <div id="marketPriceDisplay"
                                        class="text-sm font-bold text-slate-900 dark:text-white ltr-text">---</div>
                                </div>
                                <div class="text-center border-x border-slate-200 dark:border-slate-700">
                                    <div
                                        class="text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase mb-1">
                                        الربح / الخسارة $</div>
                                    <div id="pnlAmount" class="text-sm font-bold pnl-neutral ltr-text font-mono">
                                        0.00
                                    </div>
                                </div>
                                <div class="text-center">
                                    <div
                                        class="text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase mb-1">
                                        النسبة %</div>
                                    <div id="pnlPercent" class="text-sm font-bold pnl-neutral ltr-text font-mono">
                                        0.00%
                                    </div>
                                </div>
                            </div>

                            <!-- Detailed Metrics Grid -->
                            <div class="grid grid-cols-2 gap-4">
                                <div
                                    class="flex items-center justify-between p-3 bg-slate-50/50 dark:bg-slate-900/50 rounded-xl border border-slate-100 dark:border-slate-800 transition-all hover:border-blue-100 dark:hover:border-blue-900/40">
                                    <span class="text-xs font-medium text-slate-500 dark:text-slate-400">الكمية:</span>
                                    <span id="totalCoinQty"
                                        class="text-sm font-bold text-slate-700 dark:text-slate-200 ltr-text">0.00</span>
                                </div>
                                <div
                                    class="flex items-center justify-between p-3 bg-slate-50/50 dark:bg-slate-900/50 rounded-xl border border-slate-100 dark:border-slate-800 transition-all hover:border-blue-100 dark:hover:border-blue-900/40">
                                    <span
                                        class="text-xs font-medium text-slate-500 dark:text-slate-400">المستثمر:</span>
                                    <span id="totalInvestedAmount"
                                        class="text-sm font-bold text-slate-700 dark:text-slate-200 ltr-text">$0.00</span>
                                </div>
                                <div
                                    class="flex items-center justify-between p-3 bg-slate-50/50 dark:bg-slate-900/50 rounded-xl border border-slate-100 dark:border-slate-800 transition-all hover:border-emerald-100 dark:hover:border-emerald-900/40">
                                    <span class="text-xs font-medium text-slate-500 dark:text-slate-400">القيمة:</span>
                                    <span id="currentPortfolioValue"
                                        class="text-sm font-bold text-slate-700 dark:text-slate-200 ltr-text">$0.00</span>
                                </div>
                                <div
                                    class="flex items-center justify-between p-3 bg-slate-50/50 dark:bg-slate-900/50 rounded-xl border border-slate-100 dark:border-slate-800 transition-all hover:border-amber-100 dark:hover:border-amber-900/40">
                                    <span class="text-xs font-medium text-slate-500 dark:text-slate-400">المتوسط:</span>
                                    <span id="averageEntryPrice"
                                        class="text-sm font-bold text-slate-700 dark:text-slate-200 ltr-text">$0.00</span>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- Card 3: Strategy (Targets) -->
                    <div
                        class="dashboard-card card-strategy bg-white dark:bg-slate-900 rounded-2xl p-5 border border-slate-100 dark:border-slate-800 shadow-sm transition-all hover:shadow-md">
                        <div
                            class="card-header text-sm font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2">
                            <span class="card-header-icon" aria-hidden="true"><i class="fas fa-bullseye"></i></span>
                            <span class="card-header-title">الأهداف</span>
                        </div>
                        <div class="card-content space-y-3">
                            <!-- TP 1 -->
                            <div class="flex items-center gap-3">
                                <div class="flex-1 space-y-1">
                                    <label for="tpPercent1"
                                        class="block text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider">هدف
                                        1 (%)</label>
                                    <input type="number" id="tpPercent1" placeholder="%" oninput="saveAndCalculate()"
                                        class="bg-slate-50 border border-slate-200 text-slate-900 text-sm rounded-lg focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2 dark:bg-slate-800 dark:border-slate-700 dark:placeholder-slate-500 dark:text-white transition-all">
                                </div>
                                <div
                                    class="flex-1 mt-5 p-2 bg-emerald-50 dark:bg-emerald-900/10 rounded-lg border border-emerald-100 dark:border-emerald-800/30 text-center">
                                    <span id="tpPrice1"
                                        class="text-sm font-bold text-emerald-700 dark:text-emerald-400 ltr-text">0.00</span>
                                </div>
                            </div>
                            <!-- TP 2 -->
                            <div class="flex items-center gap-3">
                                <div class="flex-1 space-y-1">
                                    <label for="tpPercent2"
                                        class="block text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider">هدف
                                        2 (%)</label>
                                    <input type="number" id="tpPercent2" placeholder="%" oninput="saveAndCalculate()"
                                        class="bg-slate-50 border border-slate-200 text-slate-900 text-sm rounded-lg focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2 dark:bg-slate-800 dark:border-slate-700 dark:placeholder-slate-500 dark:text-white transition-all">
                                </div>
                                <div
                                    class="flex-1 mt-5 p-2 bg-emerald-50 dark:bg-emerald-900/10 rounded-lg border border-emerald-100 dark:border-emerald-800/30 text-center">
                                    <span id="tpPrice2"
                                        class="text-sm font-bold text-emerald-700 dark:text-emerald-400 ltr-text">0.00</span>
                                </div>
                            </div>
                            <!-- TP 3 -->
                            <div class="flex items-center gap-3">
                                <div class="flex-1 space-y-1">
                                    <label for="tpPercent3"
                                        class="block text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider">هدف
                                        3 (%)</label>
                                    <input type="number" id="tpPercent3" placeholder="%" oninput="saveAndCalculate()"
                                        class="bg-slate-50 border border-slate-200 text-slate-900 text-sm rounded-lg focus:ring-emerald-500 focus:border-emerald-500 block w-full p-2 dark:bg-slate-800 dark:border-slate-700 dark:placeholder-slate-500 dark:text-white transition-all">
                                </div>
                                <div
                                    class="flex-1 mt-5 p-2 bg-emerald-50 dark:bg-emerald-900/10 rounded-lg border border-emerald-100 dark:border-emerald-800/30 text-center">
                                    <span id="tpPrice3"
                                        class="text-sm font-bold text-emerald-700 dark:text-emerald-400 ltr-text">0.00</span>
                                </div>
                            </div>
                            <!-- SL -->
                            <div
                                class="flex items-center gap-3 mt-2 pt-2 border-t border-slate-50 dark:border-slate-800">
                                <div class="flex-1 space-y-1">
                                    <label for="slPercent"
                                        class="block text-[10px] font-bold text-rose-400 dark:text-rose-500/70 uppercase tracking-wider">وقف
                                        الخسارة (%)</label>
                                    <input type="number" id="slPercent" placeholder="%" oninput="saveAndCalculate()"
                                        class="bg-rose-50 border border-rose-100 text-rose-900 text-sm rounded-lg focus:ring-rose-500 focus:border-rose-500 block w-full p-2 dark:bg-rose-900/10 dark:border-rose-900/30 dark:placeholder-rose-800/50 dark:text-rose-200 transition-all">
                                </div>
                                <div
                                    class="flex-1 mt-5 p-2 bg-rose-50 dark:bg-rose-900/20 rounded-lg border border-rose-100 dark:border-rose-800 text-center">
                                    <span id="slPrice"
                                        class="text-sm font-bold text-rose-700 dark:text-rose-400 ltr-text">0.00</span>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </section>

            <!-- 2. Repurchase & Sell Section (Side by Side) -->
            <div class="trade-actions-row">
                <!-- Left: Repurchase -->
                <section class="section section-repurchase">
                    <h2><i class="fas fa-layer-group"></i>التعزيز <span id="currentCoinDisplay2"
                            class="coin-badge">---</span>
                    </h2>
                    <div class="repurchase-table-wrapper"
                        style="overflow-x: auto; -webkit-overflow-scrolling: touch; border-radius: 8px; border: 1px solid var(--border-color);">
                        <table class="repurchase-table">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-hashtag"></i></th>
                                    <th><i class="fas fa-percentage"></i>هبوط</th>
                                    <th><i class="fas fa-tag"></i>سعر التعزيز</th>
                                    <th><i class="fas fa-dollar-sign"></i>المبلغ</th>
                                    <th><i class="fas fa-coins"></i>الكمية</th>
                                    <th><i class="fas fa-dollar-sign"></i>ربح / خسارة</th>
                                    <th><i class="fas fa-percentage"></i>ربح / خسارة</th>
                                    <th><i class="fas fa-receipt"></i>رسوم الشراء</th>
                                    <th><i class="fas fa-calendar-alt"></i>التاريخ</th>
                                </tr>
                            </thead>
                            <tbody id="repurchaseRows"></tbody>
                        </table>
                    </div>
                    <div class="table-fees-summary">
                        <span><i class="fas fa-receipt" aria-hidden="true"></i> إجمالي رسوم الشراء</span>
                        <strong id="totalBuyFeesDca" class="ltr-text">$ 0.0000</strong>
                    </div>
                </section>

                <!-- Right: Sell Section (NEW) -->
                <section class="section section-sell">
                    <h2><i class="fas fa-cash-register"></i> البيع / جني الأرباح <span id="currentCoinDisplay3"
                            class="coin-badge">---</span>
                    </h2>

                    <!-- Sell Controls Loop -->
                    <div class="sell-controls-wrapper space-y-5">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            <!-- Quantity -->
                            <div class="space-y-2">
                                <label for="newSellQty"
                                    class="block text-xs font-bold text-slate-500 dark:text-slate-400">
                                    <i class="fas fa-coins ml-1 text-amber-500"></i> الكمية المباعة
                                </label>
                                <div class="sell-qty-input-wrap">
                                    <input type="number" id="newSellQty" placeholder="0.00"
                                        oninput="calculateSellPreview()"
                                        class="sell-qty-input bg-slate-50 border border-slate-200 text-slate-900 text-base rounded-xl focus:ring-blue-500 focus:border-blue-500 block w-full p-3.5 h-[52px] dark:bg-slate-800 dark:border-slate-700 dark:placeholder-slate-500 dark:text-white transition-all shadow-sm font-bold">
                                    <button type="button" class="sell-qty-all-btn" onclick="fillSellQtyWithRemaining()">
                                        الكل
                                    </button>
                                </div>
                            </div>

                            <!-- Price -->
                            <div class="space-y-2">
                                <label for="newSellPrice"
                                    class="block text-xs font-bold text-slate-500 dark:text-slate-400">
                                    <i class="fas fa-tag ml-1 text-emerald-500"></i> سعر البيع ($)
                                </label>
                                <input type="number" id="newSellPrice" placeholder="0.00"
                                    oninput="calculateSellPreview()"
                                    class="bg-slate-50 border border-slate-200 text-slate-900 text-base rounded-xl focus:ring-blue-500 focus:border-blue-500 block w-full p-3.5 h-[52px] dark:bg-slate-800 dark:border-slate-700 dark:placeholder-slate-500 dark:text-white transition-all shadow-sm font-bold">
                            </div>

                            <!-- Date -->
                            <div class="space-y-2">
                                <label for="newSellDate"
                                    class="block text-xs font-bold text-slate-500 dark:text-slate-400">
                                    <i class="fas fa-calendar-alt ml-1 text-indigo-500"></i> التاريخ (اختياري)
                                </label>
                                <input type="datetime-local" id="newSellDate"
                                    class="bg-slate-50 border border-slate-200 text-slate-900 text-sm rounded-xl focus:ring-blue-500 focus:border-blue-500 block w-full p-3.5 h-[52px] dark:bg-slate-800 dark:border-slate-700 dark:text-white transition-all shadow-sm manual-time-input font-medium">
                            </div>

                            <!-- Preview Box -->
                            <div class="space-y-2">
                                <label class="block text-xs font-bold text-slate-500 dark:text-slate-400">
                                    <i class="fas fa-calculator ml-1 text-blue-400"></i> معاينة الصفقة
                                </label>
                                <div id="sellPreviewText"
                                    class="flex items-center px-4 h-[52px] bg-slate-100 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-xl text-sm font-medium text-slate-500 dark:text-slate-400 italic overflow-hidden whitespace-nowrap">
                                    <i class="fas fa-info-circle ml-2"></i> ...
                                </div>
                            </div>

                            <!-- Action Button (Full Width) -->
                            <div class="md:col-span-2 pt-2">
                                <button
                                    class="w-full text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-300 font-bold rounded-xl text-base h-[52px] flex items-center justify-center gap-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800 transition-all shadow-lg shadow-blue-500/10 active:scale-[0.98]"
                                    onclick="addNewSellRecord()">
                                    <i class="fas fa-plus-circle text-lg"></i> إضافة بيع
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Sell History Table -->
                    <div class="repurchase-table-wrapper sell-table-container"
                        style="overflow-x: auto; -webkit-overflow-scrolling: touch; border-radius: 8px; border: 1px solid var(--border-color); margin-top: 15px;">
                        <table class="repurchase-table sell-table">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-hashtag"></i></th>
                                    <th><i class="fas fa-coins"></i> الكمية</th>
                                    <th><i class="fas fa-tag"></i> سعر البيع</th>
                                    <th><i class="fas fa-scale-balanced"></i> متوسط التكلفة</th>
                                    <th><i class="fas fa-wallet"></i> التكلفة</th>
                                    <th><i class="fas fa-dollar-sign"></i> الإجمالي</th>
                                    <th><i class="fas fa-chart-line"></i> الربح المحقق</th>
                                    <th><i class="fas fa-percent"></i> % الربح / الخسارة</th>
                                    <th><i class="fas fa-box-open"></i> المتبقي</th>
                                    <th><i class="fas fa-receipt"></i> رسوم البيع</th>
                                    <th><i class="fas fa-calendar-alt"></i> التاريخ</th>
                                </tr>
                            </thead>
                            <tbody id="sellRows">
                                <!-- Dynamic Sell Rows -->
                            </tbody>
                        </table>
                    </div>
                    <div class="table-fees-summary">
                        <span><i class="fas fa-receipt" aria-hidden="true"></i> إجمالي رسوم البيع</span>
                        <strong id="totalSellFeesLedger" class="ltr-text">$ 0.0000</strong>
                    </div>
                </section>
            </div>

            <section class="section-portfolio-stats">
                <div class="stats-section">
                    <h2 class="stats-section-title"><i class="fas fa-chart-line"></i>إحصائيات المحفظة</h2>

                    <div class="portfolio-distribution-area">
                        <div class="chart-container">
                            <canvas id="coinsDistributionChart"></canvas>
                            <div class="chart-center-text">
                                <div class="chart-center-title">المحفظة</div>
                                <div class="chart-center-value" id="portfolioTotalValue">$0</div>
                            </div>
                        </div>
                        <div id="coinsDistributionLegend" class="coins-legend">

                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Application Footer (Rebuilt with Flowbite & Tailwind) -->
    <footer class="app-footer mx-auto max-w-7xl px-4 pb-8 pt-4">
        <div
            class="footer-card rounded-2xl bg-white p-6 shadow-xl dark:bg-slate-900/80 dark:shadow-slate-950/50 border border-slate-200 dark:border-slate-800 transition-all duration-300 hover:shadow-2xl">
            <div class="footer-top md:flex md:items-center md:justify-between mb-6">
                <div class="footer-brand flex items-center space-x-3 space-x-reverse mb-6 md:mb-0">
                    <div class="logo-wrapper scale-75 -mr-2">
                        <img class="header-logo-svg theme-aware-logo" src="../assets/icons/Osoul Pro Dark Mode.png"
                            alt="Osoul Pro Footer Logo" loading="lazy" decoding="async">
                    </div>
                    <div class="footer-brand-text">
                        <span
                            class="self-center text-2xl font-bold whitespace-nowrap dark:text-white footer-brand-name">Osoul
                            Pro | أصول برو</span>
                        <p class="footer-brand-tag">منصتك الإحترافية لتتبع صفقاتك بشكل واضح ومنظم.</p>
                        <div class="footer-highlights" aria-label="مميزات المنصة">
                            <span class="footer-chip"><i class="fas fa-bolt"></i> تحديث مباشر</span>
                            <span class="footer-chip"><i class="fas fa-shield-alt"></i> خصوصية محلية</span>
                            <span class="footer-chip"><i class="fas fa-chart-line"></i> تحليلات دقيقة</span>
                        </div>
                    </div>
                </div>
                <div class="footer-links">
                    <div class="footer-group">
                        <div class="footer-title">تواصل</div>
                        <ul class="footer-list">
                            <li><a href="javascript:void(0)" onclick="openProfileModal()">تواصل معي</a></li>
                            <li><a href="javascript:void(0)" onclick="openTadawulModal()">قناة تداولجي</a></li>
                            <li><a href="javascript:void(0)" onclick="openDonateModal()">ادعمني</a></li>
                        </ul>
                    </div>
                    <div class="footer-divider" aria-hidden="true"></div>
                    <div class="footer-group">
                        <div class="footer-title">روابط قانونية</div>
                        <ul class="footer-list">
                            <li><a href="disclaimer.html">إخلاء المسؤولية</a></li>
                            <li><a href="privacy.html">سياسة الخصوصية</a></li>
                            <li><a href="terms.html">شروط الاستخدام</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <hr class="my-6 border-slate-200 sm:mx-auto dark:border-slate-800 lg:my-8" />
            <div class="footer-bottom">
                <span class="footer-note">نسألكم الدعاء بظهر الغيب</span>
                <div class="footer-update-actions">
                    <button id="footerUpdateCheckBtn" type="button" class="footer-update-check-btn"
                        title="التحقق من وجود تحديث جديد للتطبيق" aria-label="التحقق من وجود تحديث جديد للتطبيق">
                        <i class="fas fa-arrows-rotate" aria-hidden="true"></i>
                        <span class="footer-update-check-label">التحقق من التحديثات</span>
                    </button>
                </div>
                <div class="footer-meta" aria-label="معلومات المنصة">
                    <span><i class="fas fa-moon"></i> يدعم الوضعين</span>
                    <span><i class="fas fa-language"></i> واجهة عربية بالكامل</span>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.js"></script>







    <div id="updateModal" class="update-modal">
        <div class="update-modal-backdrop"></div>
        <div class="update-modal-content">
            <div class="update-icon-wrapper">
                <i class="fas fa-sync-alt fa-spin"></i>
            </div>
            <h3 class="update-title">جاري تحديث الأسعار</h3>
            <p class="update-status">يرجى الانتظار، يتم جلب أحدث البيانات من الأسواق...</p>
            <div class="update-dots">
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
            </div>
        </div>
    </div>

    <div id="appUpdatePopup" class="app-update-popup" hidden aria-hidden="true">
        <div class="app-update-popup__backdrop" data-action="dismiss-update"></div>
        <div class="app-update-popup__card" role="dialog" aria-modal="true" aria-labelledby="appUpdateTitle">
            <h3 id="appUpdateTitle" class="app-update-popup__title">تحديث جديد متوفر</h3>
            <p id="appUpdateVersion" class="app-update-popup__version">الإصدار: --</p>
            <ul id="appUpdateNotes" class="app-update-popup__notes"></ul>
            <p id="appInstallHint" class="app-update-popup__hint" hidden></p>
            <div class="app-update-popup__actions">
                <button id="appUpdateCloseBtn" type="button"
                    class="app-update-popup__btn app-update-popup__btn--close">إغلاق</button>
            </div>
        </div>
    </div>


    <button id="donateFab" class="donate-fab" type="button" onclick="openDonateModal()" aria-label="فتح نافذة الدعم">
        <i class="fas fa-heart"></i>
    </button>


    <div id="validationModal" tabindex="-1" aria-hidden="true"
        class="validation-overlay fixed inset-0 z-[120] hidden items-center justify-center p-4 bg-slate-900/80 backdrop-blur-md transition-all duration-300">
        <div id="validationBox"
            class="validation-box relative w-full max-w-sm bg-white rounded-2xl shadow-2xl dark:bg-slate-900 border border-slate-100 dark:border-slate-800 p-8 text-center space-y-6 transform scale-95 opacity-0 modal-content-anim">
            <div
                class="validation-icon-wrapper w-20 h-20 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center mx-auto text-blue-600 dark:text-blue-400">
                <i class="fas fa-search text-3xl animate-pulse" id="validationIcon"></i>
            </div>
            <div class="space-y-2">
                <h3 class="validation-title text-xl font-bold text-slate-900 dark:text-white" id="validationTitle">
                    جاري
                    البحث...</h3>
                <p class="validation-status text-slate-500 dark:text-slate-400 text-sm font-medium"
                    id="validationStatus">يتم التحقق من
                    الرمز في المنصات</p>
            </div>
            <div
                class="validation-progress-bg w-full bg-slate-100 dark:bg-slate-800 rounded-full h-2.5 overflow-hidden">
                <div id="validationProgress"
                    class="validation-progress-fill bg-blue-600 h-2.5 rounded-full transition-all duration-300"
                    style="width: 0%"></div>
            </div>
        </div>
    </div>

    <!-- Principal Cash Management Modal -->
    <!-- Principal Cash Management Modal -->
    <div id="principalModal" tabindex="-1" aria-hidden="true"
        class="fixed inset-0 z-[110] hidden items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm transition-all duration-300">
        <div
            class="relative w-full max-w-md bg-white rounded-2xl shadow-2xl dark:bg-slate-900 border border-slate-100 dark:border-slate-800 transition-all transform scale-95 opacity-0 modal-content-anim">
            <!-- Modal header -->
            <div class="flex items-center justify-between p-5 border-b rounded-t dark:border-slate-800">
                <h3 class="text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2">
                    <i class="fas fa-university text-blue-600"></i> إدارة رأس المال الأساسي
                </h3>
                <button type="button"
                    class="text-slate-400 bg-transparent hover:bg-slate-100 hover:text-slate-900 rounded-xl text-sm w-9 h-9 inline-flex justify-center items-center dark:hover:bg-slate-800 dark:hover:text-white transition-all"
                    onclick="closePrincipalModal()">
                    <svg class="w-3.5 h-3.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                        viewBox="0 0 14 14">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                    </svg>
                    <span class="sr-only">إغلاق</span>
                </button>
            </div>
            <!-- Modal body -->
            <div class="p-6 space-y-6">
                <div class="space-y-2">
                    <label for="principalInput"
                        class="block mb-2 text-sm font-semibold text-slate-700 dark:text-slate-300">رأس المال
                        الأساسي
                        (USD)</label>
                    <input type="number" id="principalInput"
                        class="bg-slate-50 border border-slate-200 text-slate-900 text-sm rounded-xl focus:ring-blue-500 focus:border-blue-500 block w-full p-3 dark:bg-slate-800 dark:border-slate-700 dark:placeholder-slate-400 dark:text-white transition-all shadow-sm"
                        placeholder="0.00" min="0" step="0.01">
                </div>
                <div
                    class="flex items-center justify-between p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-100 dark:border-blue-800/30">
                    <span class="text-sm font-medium text-blue-700 dark:text-blue-300">الرصيد الحالي:</span>
                    <span id="currentPrincipalInfo"
                        class="text-lg font-bold text-blue-800 dark:text-blue-200">$0.00</span>
                </div>
            </div>
            <!-- Modal footer -->
            <div
                class="flex items-center justify-end p-6 space-x-3 gap-3 border-t border-slate-100 dark:border-slate-800 rounded-b">
                <button type="button"
                    class="px-6 py-2.5 text-sm font-medium text-slate-700 bg-white border border-slate-200 hover:bg-slate-50 rounded-xl dark:bg-slate-800 dark:text-slate-300 dark:border-slate-700 dark:hover:bg-slate-700 transition-all shadow-sm"
                    onclick="closePrincipalModal()">إلغاء</button>
                <button type="button"
                    class="px-6 py-2.5 text-sm font-medium text-white bg-rose-600 hover:bg-rose-700 rounded-xl shadow-lg shadow-rose-500/30 transition-all"
                    onclick="resetPrincipal()">إعادة تعيين</button>
                <button type="button"
                    class="px-6 py-2.5 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-xl shadow-lg shadow-blue-500/30 transition-all font-bold"
                    onclick="savePrincipalInput()">حفظ التعديلات</button>
            </div>
        </div>
    </div>

    <!-- Comprehensive Bug Report Modal -->
    <div id="bugReportModal" tabindex="-1" aria-hidden="true"
        class="fixed inset-0 z-[110] hidden items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm transition-all duration-300">
        <div
            class="relative w-full max-w-2xl bg-white rounded-2xl shadow-2xl dark:bg-slate-900 border border-slate-100 dark:border-slate-800 transition-all transform scale-95 opacity-0 modal-content-anim max-h-[90vh] overflow-y-auto custom-scrollbar bug-report-modal-shell">
            <!-- Modal header -->
            <div
                class="flex items-center justify-between p-5 border-b rounded-t dark:border-slate-800 sticky top-0 bg-white dark:bg-slate-900 z-10 bug-report-modal-header">
                <h3 class="text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2 bug-report-title">
                    <i class="fas fa-bug text-rose-500"></i> الإبلاغ عن مشكلة
                </h3>
                <p class="text-slate-500 dark:text-slate-400 text-sm bug-report-intro">ساعدنا في تحسين النظام. يرجى ملء
                    التفاصيل أدناه بدقة.</p>
            </div>
            <!-- Modal body -->
            <div class="p-6 space-y-6 bug-report-form-body" id="bugReportFormBody">
                <form id="bugReportForm" onsubmit="event.preventDefault(); prepareBugPreview();" class="space-y-6 bug-report-form">
                    <!-- Hidden Auto-Collected Fields -->
                    <input type="hidden" id="bugUrl">
                    <input type="hidden" id="bugUserAgent">
                    <input type="hidden" id="bugOS">
                    <input type="hidden" id="bugScreenSize">
                    <input type="hidden" id="bugTimestamp">

                    <!-- Issue Type -->
                    <div class="space-y-3 bug-report-section bug-section-type">
                        <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 bug-report-label">نوع
                            البلاغ</label>
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 bug-type-grid">
                            <label class="relative bug-type-option">
                                <input type="radio" name="issueType" value="bug" checked onchange="toggleSeverity(true)"
                                    class="peer sr-only">
                                <div
                                    class="p-3 bg-white border border-slate-200 rounded-xl cursor-pointer hover:bg-slate-50 peer-checked:border-blue-500 peer-checked:bg-blue-50 dark:bg-slate-800 dark:border-slate-700 dark:hover:bg-slate-700 dark:peer-checked:bg-blue-900/20 transition-all text-center bug-type-card">
                                    <i class="fas fa-bug block mb-1 text-slate-500 peer-checked:text-blue-600"></i>
                                    <span class="text-xs font-medium dark:text-slate-300">خطأ برمجي</span>
                                </div>
                            </label>
                            <label class="relative bug-type-option">
                                <input type="radio" name="issueType" value="ui" onchange="toggleSeverity(false)"
                                    class="peer sr-only">
                                <div
                                    class="p-3 bg-white border border-slate-200 rounded-xl cursor-pointer hover:bg-slate-50 peer-checked:border-blue-500 peer-checked:bg-blue-50 dark:bg-slate-800 dark:border-slate-700 dark:hover:bg-slate-700 dark:peer-checked:bg-blue-900/20 transition-all text-center bug-type-card">
                                    <i class="fas fa-palette block mb-1 text-slate-500 peer-checked:text-blue-600"></i>
                                    <span class="text-xs font-medium dark:text-slate-300">تصميم</span>
                                </div>
                            </label>
                            <label class="relative bug-type-option">
                                <input type="radio" name="issueType" value="performance" onchange="toggleSeverity(true)"
                                    class="peer sr-only">
                                <div
                                    class="p-3 bg-white border border-slate-200 rounded-xl cursor-pointer hover:bg-slate-50 peer-checked:border-blue-500 peer-checked:bg-blue-50 dark:bg-slate-800 dark:border-slate-700 dark:hover:bg-slate-700 dark:peer-checked:bg-blue-900/20 transition-all text-center bug-type-card">
                                    <i
                                        class="fas fa-tachometer-alt block mb-1 text-slate-500 peer-checked:text-blue-600"></i>
                                    <span class="text-xs font-medium dark:text-slate-300">أداء</span>
                                </div>
                            </label>
                            <label class="relative bug-type-option">
                                <input type="radio" name="issueType" value="suggestion" onchange="toggleSeverity(false)"
                                    class="peer sr-only">
                                <div
                                    class="p-3 bg-white border border-slate-200 rounded-xl cursor-pointer hover:bg-slate-50 peer-checked:border-blue-500 peer-checked:bg-blue-50 dark:bg-slate-800 dark:border-slate-700 dark:hover:bg-slate-700 dark:peer-checked:bg-blue-900/20 transition-all text-center bug-type-card">
                                    <i
                                        class="far fa-lightbulb block mb-1 text-slate-500 peer-checked:text-blue-600"></i>
                                    <span class="text-xs font-medium dark:text-slate-300">اقتراح</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Title -->
                    <div class="space-y-2 bug-report-section bug-section-title">
                        <label for="bugTitle"
                            class="block text-sm font-semibold text-slate-700 dark:text-slate-300 bug-report-label">عنوان
                            المشكلة</label>
                        <input type="text" id="bugTitle"
                            class="bg-slate-50 border border-slate-200 text-slate-900 text-sm rounded-xl focus:ring-blue-500 focus:border-blue-500 block w-full p-3 dark:bg-slate-800 dark:border-slate-700 dark:placeholder-slate-400 dark:text-white transition-all shadow-sm bug-report-input"
                            placeholder="مثال: يظهر خطأ عند تحديث الأسعار" required>
                        <p class="bug-input-hint">يفضّل عنوان مختصر وواضح يصف المشكلة مباشرة.</p>
                    </div>

                    <!-- Severity -->
                    <div class="space-y-3 bug-report-section bug-section-severity" id="severityGroup">
                        <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 bug-report-label">درجة
                            الأهمية</label>
                        <div class="flex flex-wrap gap-3 bug-severity-options">
                            <label class="relative flex items-center bug-severity-option">
                                <input type="radio" name="severity" value="low" class="peer sr-only">
                                <span
                                    class="px-4 py-1.5 rounded-full text-xs font-bold border border-slate-200 bg-slate-50 text-slate-500 cursor-pointer peer-checked:border-emerald-500 peer-checked:bg-emerald-50 peer-checked:text-emerald-700 dark:bg-slate-800 dark:border-slate-700 dark:peer-checked:bg-emerald-900/20 dark:peer-checked:text-emerald-400 transition-all bug-severity-pill">منخفضة</span>
                            </label>
                            <label class="relative flex items-center bug-severity-option">
                                <input type="radio" name="severity" value="medium" checked class="peer sr-only">
                                <span
                                    class="px-4 py-1.5 rounded-full text-xs font-bold border border-slate-200 bg-slate-50 text-slate-500 cursor-pointer peer-checked:border-amber-500 peer-checked:bg-amber-50 peer-checked:text-amber-700 dark:bg-slate-800 dark:border-slate-700 dark:peer-checked:bg-amber-900/20 dark:peer-checked:text-amber-400 transition-all bug-severity-pill">متوسطة</span>
                            </label>
                            <label class="relative flex items-center bug-severity-option">
                                <input type="radio" name="severity" value="high" class="peer sr-only">
                                <span
                                    class="px-4 py-1.5 rounded-full text-xs font-bold border border-slate-200 bg-slate-50 text-slate-500 cursor-pointer peer-checked:border-rose-500 peer-checked:bg-rose-50 peer-checked:text-rose-700 dark:bg-slate-800 dark:border-slate-700 dark:peer-checked:bg-rose-900/20 dark:peer-checked:text-rose-400 transition-all bug-severity-pill">عالية</span>
                            </label>
                            <label class="relative flex items-center bug-severity-option">
                                <input type="radio" name="severity" value="critical" class="peer sr-only">
                                <span
                                    class="px-4 py-1.5 rounded-full text-xs font-bold border border-red-200 bg-red-50 text-red-500 cursor-pointer peer-checked:bg-red-600 peer-checked:text-white dark:bg-red-900/20 dark:border-red-800 transition-all bug-severity-pill">حرجة</span>
                            </label>
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="space-y-2 bug-report-section bug-section-desc">
                        <label for="bugDescription"
                            class="block text-sm font-semibold text-slate-700 dark:text-slate-300 bug-report-label">وصف
                            تفصيلي</label>
                        <textarea id="bugDescription" placeholder="اشرح ماذا حدث..." rows="4"
                            class="block w-full p-3 text-sm text-slate-900 bg-slate-50 rounded-xl border border-slate-200 focus:ring-blue-500 focus:border-blue-500 dark:bg-slate-800 dark:border-slate-700 dark:placeholder-slate-400 dark:text-white transition-all shadow-sm bug-report-textarea"
                            required></textarea>
                    </div>

                    <!-- Footer Actions -->
                    <div class="flex items-center justify-end p-0 gap-3 pt-4 bug-report-actions">
                        <button type="button"
                            class="px-6 py-2.5 text-sm font-medium text-slate-700 bg-white border border-slate-200 hover:bg-slate-50 rounded-xl dark:bg-slate-800 dark:text-slate-300 dark:border-slate-700 dark:hover:bg-slate-700 transition-all shadow-sm bug-btn-secondary"
                            onclick="closeBugReportModal()">إلغاء</button>
                        <button type="submit"
                            class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-bold rounded-xl text-sm px-10 py-2.5 text-center inline-flex items-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800 transition-all shadow-lg shadow-blue-500/30 bug-btn-primary"
                            id="submitBugBtn">
                            <span class="btn-text inline-flex items-center gap-2">معاينة وإرسال <i
                                    class="fas fa-arrow-left font-bold text-xs"></i></span>
                            <span class="btn-loader" style="display: none;"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Preview State -->
            <div class="p-6 space-y-6 overflow-hidden" id="bugReportPreview" style="display: none;">
                <h3 class="text-lg font-bold text-slate-900 dark:text-white flex items-center gap-2">
                    <i class="fab fa-whatsapp text-emerald-500 text-xl"></i> معاينة الرسالة
                </h3>
                <p class="text-slate-500 dark:text-slate-400 text-sm">يرجى مراجعة تفاصيل التقرير قبل الإرسال عبر
                    واتساب.
                </p>

                <div
                    class="preview-box border border-slate-200 dark:border-slate-700 rounded-2xl overflow-hidden p-4 bg-slate-100 dark:bg-slate-800/50">
                    <div id="whatsappPreviewText"
                        class="chat-bubble whitespace-pre-wrap text-sm text-slate-700 dark:text-slate-300"></div>
                </div>

                <div class="flex items-center justify-end space-x-3 gap-3 pt-4">
                    <button type="button"
                        class="px-6 py-2.5 text-sm font-medium text-slate-700 bg-white border border-slate-200 hover:bg-slate-50 rounded-xl dark:bg-slate-800 dark:text-slate-300 dark:border-slate-700 dark:hover:bg-slate-700 transition-all"
                        onclick="backToBugForm()">تعديل</button>
                    <button type="button"
                        class="text-white bg-emerald-600 hover:bg-emerald-700 focus:ring-4 focus:outline-none focus:ring-emerald-300 font-bold rounded-xl text-sm px-8 py-2.5 text-center inline-flex items-center dark:bg-emerald-500 dark:hover:bg-emerald-600 dark:focus:ring-emerald-800 transition-all shadow-lg shadow-emerald-500/20"
                        onclick="confirmSendWhatsApp()">
                        <i class="fab fa-whatsapp ml-2 text-lg"></i> تأكيد وفتح واتساب
                    </button>
                </div>
            </div>

            <!-- Success State -->
            <div id="bugReportSuccess" class="bug-success-state" style="display: none;">
                <div class="bug-success-panel">
                    <div class="bug-success-content">
                        <h3 class="bug-success-title">جاري فتح واتساب...</h3>
                        <p class="bug-success-text">تم تحويلك إلى واتساب. يرجى <strong>الضغط على زر الإرسال</strong> في
                            المحادثة.</p>
                        <p class="bug-success-note">
                            <i class="fas fa-circle-info" aria-hidden="true"></i>
                            إذا لم يفتح واتساب تلقائيًا، تحقّق من منع النوافذ المنبثقة ثم أعد المحاولة.
                        </p>
                    </div>
                    <div class="bug-success-icon-wrap" aria-hidden="true">
                        <span class="bug-success-icon-ring"></span>
                        <span class="bug-success-icon-ring bug-success-icon-ring-delay"></span>
                        <div class="bug-success-icon">
                            <i class="fab fa-whatsapp"></i>
                        </div>
                    </div>
                    <div class="bug-success-actions">
                        <button type="button" class="bug-success-btn" onclick="closeBugReportModal()">حسنًا</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-5 start-5 flex flex-col gap-2 z-[100] pointer-events-none"></div>

    <!-- Profile Modal -->
    <div id="profileModal" tabindex="-1" aria-hidden="true"
        class="fixed inset-0 z-[130] hidden items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm transition-all duration-300">
        <div
            class="relative w-full max-w-md bg-white rounded-[2rem] shadow-2xl dark:bg-slate-900 border border-slate-100 dark:border-slate-800 transition-all transform scale-95 opacity-0 modal-content-anim overflow-hidden p-8">

            <!-- Close Button -->
            <button type="button"
                class="absolute top-4 right-4 text-slate-400 bg-transparent hover:bg-slate-100 hover:text-slate-900 rounded-xl text-sm w-9 h-9 inline-flex justify-center items-center dark:hover:bg-slate-800 dark:hover:text-white transition-all"
                onclick="closeProfileModal()">
                <svg class="w-3.5 h-3.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                    viewBox="0 0 14 14">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                </svg>
            </button>

            <!-- Card Content -->
            <div class="flex flex-col items-center">
                <!-- Avatar -->
                <div
                    class="w-32 h-32 rounded-full p-1 bg-gradient-to-tr from-blue-500 to-cyan-500 mb-6 relative group cursor-pointer group">
                    <img id="profileAvatar" src="https://t.me/i/userpic/320/LEGACY_MAN_X.jpg" alt="Profile Avatar"
                        class="w-full h-full rounded-full object-cover border-4 border-white dark:border-slate-900 relative z-10 transition-transform duration-500 group-hover:scale-105"
                        onerror="this.onerror=null; this.src='https://ui-avatars.com/api/?name=Osoul+Pro&background=random&size=320'">
                    <!-- Glow Effect -->
                    <div
                        class="absolute inset-0 rounded-full bg-blue-500/30 blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-500">
                    </div>
                </div>

                <!-- Info -->
                <div class="text-center w-full mb-8">
                    <h2 class="text-3xl font-bold text-slate-900 dark:text-white mb-2 tracking-tight">Eternal Man
                    </h2>
                    <p class="text-lg text-slate-500 dark:text-slate-400 font-medium mb-4">مطور نظام إدارة محفظة
                        العملات
                        الرقمية أصول برو</p>

                    <!-- Message Button -->
                    <button onclick="window.open('https://t.me/LEGACY_MAN_X', '_blank')"
                        class="w-full max-w-[200px] py-3 px-6 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl shadow-lg shadow-blue-500/30 transition-all active:scale-95 flex items-center justify-center gap-2 mx-auto">
                        <i class="fas fa-envelope"></i>
                        <span>مراسلة</span>
                    </button>
                </div>

            </div>
        </div>
    </div>

    <!-- TadawulGY Modal (New) -->
    <div id="tadawulModal" tabindex="-1" aria-hidden="true"
        class="fixed inset-0 z-[130] hidden items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm transition-all duration-300">
        <div
            class="relative w-full max-w-md bg-white rounded-[2rem] shadow-2xl dark:bg-slate-900 border border-slate-100 dark:border-slate-800 transition-all transform scale-95 opacity-0 modal-content-anim overflow-hidden p-8">

            <!-- Close Button -->
            <button type="button"
                class="absolute top-4 right-4 text-slate-400 bg-transparent hover:bg-slate-100 hover:text-slate-900 rounded-xl text-sm w-9 h-9 inline-flex justify-center items-center dark:hover:bg-slate-800 dark:hover:text-white transition-all"
                onclick="closeTadawulModal()">
                <svg class="w-3.5 h-3.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                    viewBox="0 0 14 14">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                </svg>
            </button>

            <!-- Card Content -->
            <div class="flex flex-col items-center">
                <!-- Avatar -->
                <div
                    class="w-32 h-32 rounded-full p-1 bg-gradient-to-tr from-blue-500 to-cyan-500 mb-6 relative group cursor-pointer group">
                    <img id="tadawulAvatar" src="https://t.me/i/userpic/320/TadawulGY.jpg" alt="TadawulGY Avatar"
                        class="w-full h-full rounded-full object-cover border-4 border-white dark:border-slate-900 relative z-10 transition-transform duration-500 group-hover:scale-105"
                        onerror="this.onerror=null; this.src='https://ui-avatars.com/api/?name=Tadawul+GY&background=random&size=320'">
                    <!-- Glow Effect -->
                    <div
                        class="absolute inset-0 rounded-full bg-blue-500/30 blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-500">
                    </div>
                </div>

                <!-- Info -->
                <div class="text-center w-full mb-8">
                    <h2 class="text-3xl font-bold text-slate-900 dark:text-white mb-2 tracking-tight">
                        TADAWULGY-تداولجي
                    </h2>
                    <p class="text-lg text-slate-500 dark:text-slate-400 font-medium mb-4">قناة تهتم بالعملات
                        الرقمية
                        كل ما يذكر هو معلومات عامة ليست نصيحه بالبيع او الشراء</p>

                    <!-- Message Button -->
                    <button onclick="window.open('https://t.me/TadawulGY', '_blank')"
                        class="w-full max-w-[200px] py-3 px-6 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl shadow-lg shadow-blue-500/30 transition-all active:scale-95 flex items-center justify-center gap-2 mx-auto">
                        <i class="fab fa-telegram-plane"></i>
                        <span>زيارة القناة</span>
                    </button>
                </div>

                <!-- Stats Divider -->
                <div class="w-full h-px bg-slate-100 dark:bg-slate-800 mb-8"></div>

                <!-- Stats Grid -->
                <div class="grid grid-cols-3 gap-4 w-full text-center">
                    <div class="flex flex-col items-center group cursor-pointer">
                        <span
                            class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-1 group-hover:scale-110 transition-transform">+10K</span>
                        <span class="text-sm text-slate-500 dark:text-slate-400 font-medium">مشترك</span>
                    </div>

                    <div class="flex flex-col items-center group cursor-pointer">
                        <span
                            class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-1 group-hover:scale-110 transition-transform">توصيات</span>
                        <span class="text-sm text-slate-500 dark:text-slate-400 font-medium">يومية</span>
                    </div>

                    <div class="flex flex-col items-center group cursor-pointer">
                        <span
                            class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-1 group-hover:scale-110 transition-transform">إستشارة</span>
                        <span class="text-sm text-slate-500 dark:text-slate-400 font-medium">إحترافية</span>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Crypto Support Modal -->
    <div id="donateModal" tabindex="-1" aria-hidden="true"
        class="fixed inset-0 z-[130] hidden items-center justify-center p-4 bg-slate-900/70 backdrop-blur-sm transition-all duration-300">
        <div class="relative w-full max-w-2xl donate-modal donate-modal-shell modal-content-anim transform scale-95 opacity-0">
            <div class="donate-header">
                <div class="donate-title-wrap">
                    <div class="donate-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div>
                        <h3>ادعمني</h3>
                    </div>
                </div>
                <button type="button" class="donate-close" aria-label="إغلاق نافذة الدعم" onclick="closeDonateModal()">
                    <svg class="w-3.5 h-3.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                        viewBox="0 0 14 14">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                    </svg>
                    <span class="sr-only">إغلاق</span>
                </button>
            </div>

            <div class="donate-body">
                <p class="donate-intro">نقدّر دعمك الكريم، إنك تساهم بشكل مباشر في تطوير الموقع وتحسين وإضافة
                    مزايا جديدة. شكراً لثقتكم ودعمكم المستمر <i class="fas fa-heart" aria-hidden="true"></i></p>
                <div class="donate-layout">
                    <div class="donate-panel donate-panel--left">
                        <div class="donate-platform donate-platform--top">
                            <div class="donate-platform-item">
                                <div class="donate-address donate-address--compact donate-address--inline">
                                    <span class="donate-platform-icon donate-platform-icon--binance" aria-hidden="true">
                                        <img src="https://cdn.simpleicons.org/binance/ffffff" alt="">
                                    </span>
                                    <span class="donate-platform-badge">Binance ID</span>
                                    <input id="donateBinanceId" type="text" readonly value="781080114" dir="ltr">
                                    <button class="donate-copy-btn icon-only" type="button"
                                        onclick="copyDonateBinanceId(this)" aria-label="نسخ Binance ID">
                                        <i class="far fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="donate-platform-item">
                                <div class="donate-address donate-address--compact donate-address--inline">
                                    <span class="donate-platform-icon donate-platform-icon--bybit" aria-hidden="true">
                                        <img src="https://upload.wikimedia.org/wikipedia/commons/1/14/Bybit_Logo.svg"
                                            alt="">
                                    </span>
                                    <span class="donate-platform-badge">Bybit UID</span>
                                    <input id="donateBybitId" type="text" readonly value="367978712" dir="ltr">
                                    <button class="donate-copy-btn icon-only" type="button"
                                        onclick="copyDonateBybitId(this)" aria-label="نسخ Bybit UID">
                                        <i class="far fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div id="donateList" class="donate-list" role="list"></div>
                    </div>

                    <div class="donate-panel donate-panel--right">
                        <div id="donateDetails" class="donate-details">
                            <div class="donate-details-header">
                                <span id="donateSelectedTitle" class="donate-details-title">USDT</span>
                                <span id="donateSelectedBadge" class="donate-details-badge">BEP20</span>
                            </div>
                            <div class="donate-address-box">
                                <div id="donateAddress" class="donate-address-value" dir="ltr"></div>
                                <button id="donateCopyBtn" class="donate-copy-btn donate-copy-btn--big icon-only"
                                    type="button" aria-label="نسخ العنوان">
                                    <i class="far fa-copy"></i>
                                </button>
                            </div>
                            <div id="donateMemoWrap" class="donate-memo" style="display:none;">
                                <span class="memo-badge">Memo</span>
                                <span id="donateMemoValue"></span>
                                <button id="donateMemoCopyBtn" class="donate-copy-btn donate-copy-btn--memo icon-only"
                                    type="button" aria-label="نسخ الميمو">
                                    <i class="far fa-copy"></i>
                                </button>
                            </div>
                            <div id="donateWarning" class="donate-note donate-warning donate-warning-full">
                                <i class="fas fa-triangle-exclamation" aria-hidden="true"></i> تأكد من اختيار الشبكة الصحيحة.
                                الإرسال على شبكة خاطئة قد يؤدي إلى ضياع الأموال.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../data/exchanges.spot.js"></script>
    <script src="../services/feeCalculator.js"></script>
    <script src="../ui/tableRenderer.js"></script>
    <script src="../ui/onboardingModal.js"></script>
    <script src="../ui/exchangeSettings.js"></script>
    <script src="../assets/js/script.js?v=8"></script>
</body>

</html>
